""" FSM transition controller- Autogenerated by Loki - Code Gen
"""

import connexion
import six

from swagger_server import util

from swagger_server.database import db
from swagger_server.database.models.{{model_name}} import {{model_name}}
from swagger_server.fsm.{{fsm_class_name}} import machine

from swagger_server.models.link import Link
from swagger_server.models.matter_response import MatterResponse

{{# triggers }}
def do_{{name}}({{object_id}}):  # noqa: E501
    """Trigger transition {{name}}

    Advances the FSM # noqa: E501

    :param {{object_id}}: The {{object_id}} of the Matter object to retrieve
    :type {{object_id}}: float

    :rtype: None
    """

    try: 
        model_obj = {{model_name}}.get_by_id(id={{object_id}})
        
        if model_obj is None:
            return "Matter object not found", 404

        fsm = model_obj.to_obj()

        machine.set_state(fsm.state)
        trigger_list = machine.get_current_triggers()
        if '{{name}}' in trigger_list:
            machine.model.{{name}}()
            model_obj.state = machine.get_current_state()
            db.session.add(model_obj)
            db.session.commit()

            action_list = machine.get_actions_dict(id=fsm.id)
            self_link = Link( rel="self", href=f'http://localhost:8763/v1/matter/{fsm.id}')
        
            resp = MatterResponse(_class='matter', properties=model_obj.to_obj(), actions=action_list, links=self_link)
            return resp            
        else:
            return "Transition not found", 404
    except:
        return "Internal Server Error", 500


{{/ triggers }}